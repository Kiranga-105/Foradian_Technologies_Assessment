
def menu
  loop do
    puts "\nWelcome to Student-Course Management"
    puts "1. Create Student"
    puts "2. List Students"
    puts "3. Create Course"
    puts "4. List Courses"
    puts "5. Enroll Student in Course"
    puts "6. List Enrollments"
    puts "7. Find Courses by Student"
    puts "8. Find Students by Course"
    puts "9. Exit"
    print "Enter choice: "
    choice = gets.chomp.to_i

    case choice
    when 1
      create_student
    when 2
      list_students
    when 3
      create_course
    when 4
      list_courses
    when 5
      enroll_student
    when 6
      list_enrollments
    when 7
      find_courses_by_student
    when 8
      find_students_by_course
    when 9
      puts "Goodbye!"; break
    else
      puts "Invalid choice"
    end
  end
end

def create_student
  print "Name: "; name = gets.chomp
  print "Email: "; email = gets.chomp
  student = Student.new(name: name, email: email)
  if student.save
    puts "Student created!"
  else
    puts "Errors: #{student.errors.full_messages.join(', ')}"
  end
end

def list_students
  Student.all.each { |s| puts "#{s.id}. #{s.name} (#{s.email})" }
end

def create_course
  print "Title: "; title = gets.chomp
  print "Code: "; code = gets.chomp
  course = Course.new(title: title, code: code)
  if course.save
    puts "Course created!"
  else
    puts "Errors: #{course.errors.full_messages.join(', ')}"
  end
end

def list_courses
  Course.all.each { |c| puts "#{c.id}. #{c.title} (#{c.code})" }
end

def enroll_student
  list_students
  print "Enter student id: "; sid = gets.chomp
  list_courses
  print "Enter course id: "; cid = gets.chomp
  enrollment = Enrollment.new(student_id: sid, course_id: cid)
  if enrollment.save
    puts "Enrolled successfully!"
  else
    puts "Errors: #{enrollment.errors.full_messages.join(', ')}"
  end
end

def list_enrollments
  Enrollment.includes(:student, :course).each do |e|
    puts "#{e.student.name} -> #{e.course.title}"
  end
end

def find_courses_by_student
  print "Enter student id: "; sid = gets.chomp
  student = Student.find_by(id: sid)
  if student
    student.courses.each { |c| puts c.title }
  else
    puts "Student not found"
  end
end

def find_students_by_course
  print "Enter course id: "; cid = gets.chomp
  course = Course.find_by(id: cid)
  if course
    course.students.each { |s| puts s.name }
  else
    puts "Course not found"
  end
end

menu
